

<!doctype html>
<html lang="en" class="no-js">
  <head>
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-3852793730107162",
        enable_page_level_ads: true
      });
    </script>
    

<meta charset="utf-8">



<!-- begin SEO -->









<title>Solving problem when running Faster R-CNN on GTX 1070 - Mahaveer Senior Deep Learning Engineer</title>







<meta property="og:locale" content="en">
<meta property="og:site_name" content="Mahaveer Senior Deep Learning Engineer">
<meta property="og:title" content="Solving problem when running Faster R-CNN on GTX 1070">


  <link rel="canonical" href="http://localhost:4000/mahaveer0suthar.github.io/project/Problem-Faster-RCNN-GPU/">
  <meta property="og:url" content="http://localhost:4000/mahaveer0suthar.github.io/project/Problem-Faster-RCNN-GPU/">



  <meta property="og:description" content="Hello guys, it’s great to be here with you today (why do I keep saying that boring greeting, you may ask). To be honest, there are a lot of things I want to share to you, especially since I built my own machine for Deep Learning. Of course, having my own machine is great, it allows me to try every crazy idea which has ever crossed through my mind, without giving a damn thought about the payment. However, good thing is followed by troubles, as it always be.">





  

  



  <meta property="og:image" content="http://localhost:4000/mahaveer0suthar.github.io/images/projects/problem-faster-rcnn-gpu/gpu_ok.png">



  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2016-11-03T00:00:00+05:30">








  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Mahaveer Suthar",
      "url" : "http://localhost:4000/mahaveer0suthar.github.io",
      "sameAs" : null
    }
  </script>






<!-- end SEO -->


<link href="http://localhost:4000/mahaveer0suthar.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="Mahaveer Senior Deep Learning Engineer Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/mahaveer0suthar.github.io/assets/css/main.css">

<meta http-equiv="cleartype" content="on">


    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="http://localhost:4000/mahaveer0suthar.github.io/">Mahaveer Senior Deep Learning Engineer</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/mahaveer0suthar.github.io/tutorials/">Tutorials</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/mahaveer0suthar.github.io/portfolio/">Projects</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/mahaveer0suthar.github.io/about/">About</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/mahaveer0suthar.github.io/terms/">Terms and Privacy Policy</a></li>
          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    





<div id="main" role="main">
  


  <div class="sidebar sticky">
  



<div itemscope itemtype="http://schema.org/Person">

  <div class="author__avatar">
    
    	<img src="http://localhost:4000/mahaveer0suthar.github.io/images/bio-photo.jpg" class="author__avatar" alt="Mahaveer Suthar">
    
  </div>

  <div class="author__content">
    <h3 class="author__name">Mahaveer Suthar</h3>
    <p class="author__bio">Senior Deep Learning Engineer</p>
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li><i class="fa fa-fw fa-map-marker" aria-hidden="true"></i> New Delhi, India</li>
      
      
      
        <li><a href="mailto:mahaveer0suthar@gmail.com"><i class="fa fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
      
      
      
        <li><a href="https://twitter.com/mahaveer0suthar"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
      
      
      
        <li><a href="https://plus.google.com/+mahaveer0suthar"><i class="fa fa-fw fa-google-plus-square" aria-hidden="true"></i> Google+</a></li>
      
      
        <li><a href="https://www.linkedin.com/in/mahaveer0suthar"><i class="fa fa-fw fa-linkedin-square" aria-hidden="true"></i> LinkedIn</a></li>
      
      
        <li><a href="https://www.xing.com/profile/Mahaveer_Suthar"><i class="fa fa-fw fa-xing-square" aria-hidden="true"></i> XING</a></li>
      
      
      
      
      
        <li><a href="https://github.com/mahaveer0suthar"><i class="fa fa-fw fa-github" aria-hidden="true"></i> Github</a></li>
      
      
        <li><a href="https://www.stackoverflow.com/users/9073242/mahaveer-suthar"><i class="fa fa-fw fa-stack-overflow" aria-hidden="true"></i> Stackoverflow</a></li>
      
      
      
      
      
      
      
      
      
      
      
      
    </ul>
  </div>
</div>

  
    
      
      
      
    
    
      


<nav class="nav__list">
  
  <ul>
    
      <li>
        
          <span class="nav__sub-title">Most Popular</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="http://localhost:4000/mahaveer0suthar.github.io/project/Sequence-To-Sequence/" class="">■ Creating a language translation model</a></li>
          
            
            

            
            

            <li><a href="http://localhost:4000/mahaveer0suthar.github.io/project/Creating-Text-Generator-Using-Recurrent-Neural-Network/" class="">■ Creating a text generator with RNNs</a></li>
          
            
            

            
            

            <li><a href="http://localhost:4000/mahaveer0suthar.github.io/project/Running-Faster-RCNN-Ubuntu/" class="">■ Running Faster R-CNN on Ubuntu</a></li>
          
            
            

            
            

            <li><a href="http://localhost:4000/mahaveer0suthar.github.io/project/Installing-Caffe-Ubuntu/" class="">■ Installing Caffe on Ubuntu 16.04</a></li>
          
            
            

            
            

            <li><a href="http://localhost:4000/mahaveer0suthar.github.io/tutorial/Setting-Up-Python-Environment-For-Computer-Vision-And-Machine-Learning/" class="">■ Installing OpenCV & Keras</a></li>
          
            
            

            
            

            <li><a href="http://localhost:4000/mahaveer0suthar.github.io/project/Real-Time-Object-Recognition-part-two/" class="">■ Real time Object Recognition</a></li>
          
            
            

            
            

            <li><a href="http://localhost:4000/mahaveer0suthar.github.io/tutorial/Regularization/" class="">■ Regularization</a></li>
          
            
            

            
            

            <li><a href="http://localhost:4000/mahaveer0suthar.github.io/tutorial/Cross-Validation/" class="">■ Cross Validation</a></li>
          
            
            

            
            

            <li><a href="http://localhost:4000/mahaveer0suthar.github.io/tutorial/Machine-Learning-Definition/" class="">■ What is Machine Learning?</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>
    
  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Solving problem when running Faster R-CNN on GTX 1070">
    <meta itemprop="description" content="Hello guys, it’s great to be here with you today (why do I keep saying that boring greeting, you may ask). To be honest, there are a lot of things I want to share to you, especially since I built my own machine for Deep Learning. Of course, having my own machine is great, it allows me to try every crazy idea which has ever crossed through my mind, without giving a damn thought about the payment. However, good thing is followed by troubles, as it always be.">
    <meta itemprop="datePublished" content="November 03, 2016">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">Solving problem when running Faster R-CNN on GTX 1070
</h1>
          
            <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  9 minute read
	
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        <p>Hello guys, it’s great to be here with you today (why do I keep saying that boring greeting, you may ask). To be honest, there are a lot of things I want to share to you, especially since I built my own machine for Deep Learning. Of course, having my own machine is great, it allows me to try every crazy idea which has ever crossed through my mind, without giving a damn thought about the payment. However, good thing is followed by troubles, as it always be.</p>

<p>You might read my last post about my experience in installing Caffe on Ubuntu 16.04, with CUDA and cuDNN to make use of the great power of the GPU. Yeah, we went through so many steps to install so many necessary things. And fortunately, things worked flawlessly in the end. For ones who haven’t read it yet, you can find it right below:</p>

<ul>
  <li><a href="https://mahaveer0suthar.github.io/project/Installing-Caffe-Ubuntu/" target="_blank">Installing Caffe on Ubuntu 16.04 </a></li>
</ul>

<p>And as you can guess, the next thing I did right after having Caffe installed on my machine, is grabbing the latest Python implementation of Faster R-CNN. I once talked about how to compile and run Faster R-CNN on Ubuntu in CPU Mode, you can refer to it here:</p>

<ul>
  <li><a href="https://mahaveer0suthar.github.io/project/Running-Faster-RCNN-Ubuntu/" target="_blank">Compiling and Running Faster R-CNN on Ubuntu (CPU Mode)</a></li>
</ul>

<script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<!-- MyPageAds -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3852793730107162" data-ad-slot="2103500933" data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<p>Obviously, once you are able to run Faster R-CNN in CPU Mode, making it work with GPU may not sound like a big deal. Why? Because you had successfully installed Caffe, which means you had gone through all the most confusing steps to get CUDA and cuDNN libraries ready. But to tell the truth, I failed to, on the first try!</p>

<p>It was a shock to me, which took me a while to overcome. Then I soon realized that, it’s all on me now because it was me who built my own machine. So I had no choice, but to figure it out myself. And after just more than one hour, the problem was solved. The problem always looks harder than it’s supposed to be. I’ve been taught that simple thing so many times in my life, and I just kept forgetting about it. And that’s also the reason why I’m writing this post, to share with you some experience to deal with this kind of troubles.</p>

<p>Let’s start from the beginning. I was so excited to get everything ready right after installing Ubuntu, so I immediately jumped into installing Caffe without any consideration. And as you may guess, I grabbed all in the latest version, which means that at first, I installed cuDNN v5.1 to CUDA installation folder.</p>

<script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<!-- MidPageAds2 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3852793730107162" data-ad-slot="2275566366" data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<p>Things worked just right with Caffe, until it came to Faster R-CNN. To make it more clear, I downloaded the latest Python implementation of Faster R-CNN from their GitHub as before:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">git</span> <span class="n">clone</span> <span class="o">--</span><span class="n">recursive</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">rbgirshick</span><span class="o">/</span><span class="n">py</span><span class="o">-</span><span class="n">faster</span><span class="o">-</span><span class="n">rcnn</span><span class="o">.</span><span class="n">git</span></code></pre></figure>

<p>After that, I compiled the libraries by jumping into <em>lib</em> folder and run:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">cd</span> <span class="n">lib</span>
<span class="n">make</span></code></pre></figure>

<p>Luckily, there’s no need to change anything this time. Phew! Then I went backward, then jumped into the <em>caffe-fast-rcnn</em> folder, create <em>Makefile.config</em> from <em>Makefile.config.example</em> file, then applied some necessary modifications to it. That was exactly the same as what we did with Caffe’s installation. You can refer to the link I showed above. And it’s time to compile Caffe for Faster R-CNN:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">cd</span> <span class="o">../</span><span class="n">caffe</span><span class="o">-</span><span class="n">fast</span><span class="o">-</span><span class="n">rcnn</span>
<span class="n">make</span> <span class="o">-</span><span class="n">j8</span> <span class="o">&amp;&amp;</span> <span class="n">make</span> <span class="n">pycaffe</span></code></pre></figure>

<p>And I received some unexpected result, like below:</p>

<p><img src="/images/projects/problem-faster-rcnn-gpu/cudnn5_error.png" alt="cudnn5_error" /></p>

<script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<!-- MyPageAds -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3852793730107162" data-ad-slot="2103500933" data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<p>Obviously, as the errors were self-explained, there was something wrong with the cuDNN v5.1 library. Did I just say <em>v5.1</em>? That was all my bad, since I forgot that Faster R-CNN is still <strong>incompatible</strong> with cuDNN v5.1. This wouldn’t happen if I considered carefully before installing cuDNN. But that was an easy fix, since it seemed like replacing with <em>cuDNN v4</em> helps fix the problem. So I gave that thought a try. The installation of cuDNN v4 is exactly same as cuDNN v5.1 so I omit it from here.</p>

<p>After re-installing cuDNN, I ran it again to see if it works:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">make</span> <span class="n">clean</span> <span class="c1"># to delete the previous progress
</span><span class="n">make</span> <span class="o">-</span><span class="n">j8</span> <span class="o">&amp;&amp;</span> <span class="n">make</span> <span class="n">pycaffe</span></code></pre></figure>

<p>No errors shown this time. Thank God, seems like it works now, I thought.</p>

<p><img src="/images/projects/problem-faster-rcnn-gpu/cudnn4_ok.png" alt="cudnn4_ok" /></p>

<p>So I moved on to prepare the pre-trained model, just like the instructions on their GitHub repository:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">cd</span> <span class="o">..</span>
<span class="o">./</span><span class="n">data</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">fetch_faster_rcnn_models</span><span class="o">.</span><span class="n">sh</span></code></pre></figure>

<p>It took some minutes to complete, since the model is quite large in size. Now, I got everything ready and couldn’t wait any longer to run the <em>demo</em>:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">python</span> <span class="o">./</span><span class="n">tools</span><span class="o">/</span><span class="n">demo</span><span class="o">.</span><span class="n">py</span></code></pre></figure>

<p>And here’s the result I had, nothing seems to go wrong, I guessed:</p>

<p><img src="/images/projects/problem-faster-rcnn-gpu/cudnn4_no_image.png" alt="cudnn4_no_image" /></p>

<p>To tell the truth, I think I’m a very patient guy. So I just left it there for a while. “So, where are all the images?”, I nearly talked to the screen. The reason why I couldn’t stay calm is that, this time there were no errors shown, and no images came out to screen, either. It took me another while to admit that something was going wrong somewhere, and I had to figure it out. Since we ran the <em>demo.py</em> file, then looking at that file first may help find something.</p>

<script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<!-- MidPageAds2 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3852793730107162" data-ad-slot="2275566366" data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<p>Since I had read the paper of Faster R-CNN before, so it was somehow easy to understand what each part of the code is doing. To recap a little bit, as I shown you in the previous post, here’s the result we want to see:</p>

<p><img src="/images/projects/running-faster-rcnn-ubuntu/1.png" alt="result" /></p>

<p>So what we want is an image (at least), in which each detected object was bounded by a rectangle, with some text to indicate which class it belongs to.
Therefore, it’s not the complicated code used for detecting, but the two parts below that I want you to focus into:</p>

<p><img src="/images/projects/problem-faster-rcnn-gpu/demo_py.png" alt="demo_py" /></p>

<p>You can refer to the paper of Faster R-CNN to find some more details. To make it easy to understand, Faster R-CNN searched for some regions which likely contains an object, then each object was detected with probabilities to indicate how likely that object belongs to a particular class. Let’s open the <em>demo.py</em> file, and make the following modification for a better understand:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">demo</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">image_name</span><span class="p">):</span>
     <span class="s">"""Detect object classes in an image using pre-computed object proposals."""</span>
 
     <span class="c1"># Load the demo image
</span>     <span class="n">im_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">DATA_DIR</span><span class="p">,</span> <span class="s">'demo'</span><span class="p">,</span> <span class="n">image_name</span><span class="p">)</span>
     <span class="n">im</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">im_file</span><span class="p">)</span>
 
     <span class="c1"># Detect all object classes and regress object bounds
</span>     <span class="n">timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
     <span class="n">timer</span><span class="o">.</span><span class="n">tic</span><span class="p">()</span>
     <span class="n">scores</span><span class="p">,</span> <span class="n">boxes</span> <span class="o">=</span> <span class="n">im_detect</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">im</span><span class="p">)</span>
     <span class="k">print</span><span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="c1"># ADD THIS LINE!!!
</span>     <span class="n">timer</span><span class="o">.</span><span class="n">toc</span><span class="p">()</span></code></pre></figure>

<p>Add one line like above inside the <em>demo</em> method in <em>demo.py</em> file so that we can know the shape of the output scores, then run it again, here’s what I received:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">Loaded</span> <span class="n">network</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mahaveer</span><span class="o">/</span><span class="n">py</span><span class="o">-</span><span class="n">faster</span><span class="o">-</span><span class="n">rcnn</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">faster_rcnn_models</span><span class="o">/</span><span class="n">VGG16_faster_rcnn_final</span><span class="o">.</span><span class="n">caffemodel</span>
<span class="o">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="n">Demo</span> <span class="k">for</span> <span class="n">data</span><span class="o">/</span><span class="n">demo</span><span class="o">/</span><span class="mf">000456.j</span><span class="n">pg</span>
<span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
<span class="n">Detection</span> <span class="n">took</span> <span class="mf">0.069</span><span class="n">s</span> <span class="k">for</span> <span class="mi">300</span> <span class="nb">object</span> <span class="n">proposals</span>
<span class="o">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="n">Demo</span> <span class="k">for</span> <span class="n">data</span><span class="o">/</span><span class="n">demo</span><span class="o">/</span><span class="mf">000542.j</span><span class="n">pg</span>
<span class="p">(</span><span class="mi">259</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
<span class="n">Detection</span> <span class="n">took</span> <span class="mf">0.064</span><span class="n">s</span> <span class="k">for</span> <span class="mi">259</span> <span class="nb">object</span> <span class="n">proposals</span>
<span class="o">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="n">Demo</span> <span class="k">for</span> <span class="n">data</span><span class="o">/</span><span class="n">demo</span><span class="o">/</span><span class="mf">001150.j</span><span class="n">pg</span>
<span class="p">(</span><span class="mi">223</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
<span class="n">Detection</span> <span class="n">took</span> <span class="mf">0.054</span><span class="n">s</span> <span class="k">for</span> <span class="mi">223</span> <span class="nb">object</span> <span class="n">proposals</span>
<span class="o">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="n">Demo</span> <span class="k">for</span> <span class="n">data</span><span class="o">/</span><span class="n">demo</span><span class="o">/</span><span class="mf">001763.j</span><span class="n">pg</span>
<span class="p">(</span><span class="mi">201</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
<span class="n">Detection</span> <span class="n">took</span> <span class="mf">0.052</span><span class="n">s</span> <span class="k">for</span> <span class="mi">201</span> <span class="nb">object</span> <span class="n">proposals</span>
<span class="o">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="n">Demo</span> <span class="k">for</span> <span class="n">data</span><span class="o">/</span><span class="n">demo</span><span class="o">/</span><span class="mf">004545.j</span><span class="n">pg</span>
<span class="p">(</span><span class="mi">172</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
<span class="n">Detection</span> <span class="n">took</span> <span class="mf">0.051</span><span class="n">s</span> <span class="k">for</span> <span class="mi">172</span> <span class="nb">object</span> <span class="n">proposals</span></code></pre></figure>

<script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<!-- MyPageAds -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3852793730107162" data-ad-slot="2103500933" data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<p>The model used for demo file was fine-tuned so that it can classify 20 classes, plus one <em>background</em> class, so we have 21 classes in total. Let’s look at the result of the first image. The algorithm proposed 300 object regions (or we can say 300 rectangles can be drawn at max), and the corresponding scores had the shape of (300, 21). It means that each proposal, the algorithm computed all 21 probabilities for all classes. And we will base on those probabilities to decide which class it belongs to.</p>

<p>Now let’s look at the first part which I highlighted above. What it’s doing is getting the first probability which is greater than the threshold value (it was set to 0.5 this time). So, let’s print out the probabilities to see why it couldn’t get through the <em>if</em> condition which followed:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">vis_detections</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">dets</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
     <span class="s">"""Draw detected bounding boxes."""</span>
     <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dets</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">thresh</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
     <span class="k">print</span><span class="p">(</span><span class="n">dets</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># ADD THIS LINE!!!
</span>     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
         <span class="k">return</span></code></pre></figure>

<p>Let’s add the line above, right before the <em>if</em> condition, then run it again to see what happens:</p>

<p>And here’s the result:</p>

<p><img src="/images/projects/problem-faster-rcnn-gpu/low_proba.png" alt="low_proba" /></p>

<p>And at this time, I thought I knew where the problem came from. None of the probabilities was greater than 0.5, so obviously I ended up with no images being shown. Then, an idea came through my mind. “Why don’t I try to run on CPU?”, I thought.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">python</span> <span class="o">./</span><span class="n">tools</span><span class="o">/</span><span class="n">demo</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">cpu</span></code></pre></figure>

<p>The result was like below. I was totally speechless.</p>

<p><img src="/images/projects/problem-faster-rcnn-gpu/cpu_ok.png" alt="cpu_ok" /></p>

<p>So I got to go through such a long way, to find out the place which may cause the problem. And thanks to the CPU, or I have to say: I had to make use of the CPU to be sure whether I got it right. Anyway, at least I knew that the compilation was successfully got through. And, the problem is likely from the GPU. Wait, what? The most expensive part of the machine caused the problem? That was ridiculous, I thought. But I couldn’t admit that, so I ran into the net right after. The bad news is: yeah, it was caused by the GPU. And the good news? The good news is: the problem happened because the new GPUs don’t support cuDNN older than v5. Well, you gotta be kidding me. Caffe doesn’t work with cuDNN newer than cuDNN v4, and my GTX 1070 doesn’t support cuDNN older than v5. So does it mean that I won’t be able to run Faster R-CNN on my machine?</p>

<script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<!-- MidPageAds2 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3852793730107162" data-ad-slot="2275566366" data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<p>Thinking it that way did depress me a lot. But fortunately, it turns out that re-compiling Faster R-CNN without cuDNN help solve it. So I moved on and gave it my last shot. I opened the <em>Makefile.config</em>, comment out the <em>USE_CUDNN</em> option, then compile it again. After the compilation completes, I ran it again, hoped that it works for me this time:</p>

<p><img src="/images/projects/problem-faster-rcnn-gpu/gpu_ok.png" alt="gpu_ok" /></p>

<p>It finally worked! That was like you woke up after a nightmare. But it was fantastic! I mean, the feeling when you could finally make things done is hard to express, right?</p>

<script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<!-- MyPageAds -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3852793730107162" data-ad-slot="2103500933" data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<h3 id="summary">Summary</h3>

<p>In today’s post, I have shown you a problem when running Faster R-CNN with the GTX-1070, which caused the images not being shown when it’s done. Going through every step above, it seemed like the problem was not that hard, and that I didn’t have to make such a long post. As I mentioned earlier, sometimes you will have to deal with the problems yourself, and sometimes, searching Google for the answer in the very beginning is not a good practice at all. As an developer, especially a Machine Learning developer, it’s likely that you are working with not only codes, but also many hard-to-understand algorithms, at least trying to figure things out yourself in the beginning will help you understand the problem more deeper so that the community can get involved efficiently, it also help you gain some very precious experience. And through times, you will be less likely to give up when struggling problems.</p>

<p>That’s all I want to tell you today. I’ll be more than happy if you find this post helpful. Now, goodbye and see you in the next post!</p>

        
      </section>

      <footer class="page__meta">
        
        


  




  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="http://localhost:4000/mahaveer0suthar.github.io/tags/#caffe" class="page__taxonomy-item" rel="tag">caffe</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/mahaveer0suthar.github.io/tags/#compile" class="page__taxonomy-item" rel="tag">compile</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/mahaveer0suthar.github.io/tags/#cpu-mode" class="page__taxonomy-item" rel="tag">cpu mode</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/mahaveer0suthar.github.io/tags/#essential" class="page__taxonomy-item" rel="tag">essential</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/mahaveer0suthar.github.io/tags/#faster-r-cnn" class="page__taxonomy-item" rel="tag">faster r-cnn</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/mahaveer0suthar.github.io/tags/#gpu" class="page__taxonomy-item" rel="tag">gpu</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/mahaveer0suthar.github.io/tags/#gtx-1070" class="page__taxonomy-item" rel="tag">gtx 1070</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/mahaveer0suthar.github.io/tags/#image-not-showing" class="page__taxonomy-item" rel="tag">image not showing</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/mahaveer0suthar.github.io/tags/#machine-learning" class="page__taxonomy-item" rel="tag">machine-learning</a>
    
    </span>
  </p>




  




  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="http://localhost:4000/mahaveer0suthar.github.io/categories/#project" class="page__taxonomy-item" rel="tag">Project</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2016-11-03T00:00:00+05:30">November 03, 2016</time></p>
        
      </footer>

      

<section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/mahaveer0suthar.github.io/project/Problem-Faster-RCNN-GPU/" class="btn btn--twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/mahaveer0suthar.github.io/project/Problem-Faster-RCNN-GPU/" class="btn btn--facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=http://localhost:4000/mahaveer0suthar.github.io/project/Problem-Faster-RCNN-GPU/" class="btn btn--google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/mahaveer0suthar.github.io/project/Problem-Faster-RCNN-GPU/" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>

      


  <nav class="pagination">
    
      <a href="http://localhost:4000/mahaveer0suthar.github.io/project/Installing-Caffe-Ubuntu/" class="pagination--pager" title="Installing Caffe on Ubuntu 16.04 (GPU Mode with CUDA)
">Previous</a>
    
    
      <a href="http://localhost:4000/mahaveer0suthar.github.io/tutorial/Support-Vector-Machine/" class="pagination--pager" title="Machine Learning Part 10: Linear Support Vector Machine
">Next</a>
    
  </nav>

    </div>

    
      

<div class="page__comments">
  
  
    <h4 class="page__comments-title">Leave a Comment</h4>
    <section id="disqus_thread"></section>
  
</div>
    
  </article>

  
  
    <div class="page__related">
      
        <h4 class="page__related-title">You May Also Enjoy</h4>
      
      <div class="grid__wrapper">
        
          
            





<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "http://localhost:4000/mahaveer0suthar.github.io/images/projects/tensorflow-install/tensorflow_logo.png"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/mahaveer0suthar.github.io/tutorial/What-I-talk-about-Tensorflow/" rel="permalink">What I talk when I talk about Tensorflow
</a>
      
    </h2>

    
      <p class="page__date page__meta"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2018-11-02T00:00:00+05:30">November 02, 2018</time></p>
    
    
    <p class="archive__item-excerpt" itemprop="description">Some of my collegues, as well as many of my readers told me that they had problems using Tensorflow for their projects. Something like this:

</p>
  </article>
</div>

          
        
          
            





<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "http://localhost:4000/mahaveer0suthar.github.io/images/projects/installing-nvidia-docker/docker-logo.png"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/mahaveer0suthar.github.io/project/Installing-NVIDIA-Docker-On-Ubuntu-16.04/" rel="permalink">Installing NVIDIA Docker On Ubuntu 16.04
</a>
      
    </h2>

    
      <p class="page__date page__meta"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2018-02-04T00:00:00+05:30">February 04, 2018</time></p>
    
    
    <p class="archive__item-excerpt" itemprop="description">Hey guys, it has been quite a long while since my last blog post (for almost a year, I guess). Today, I am going to tell you about something that I wish I ha...</p>
  </article>
</div>

          
        
          
            





<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "http://localhost:4000/mahaveer0suthar.github.io/images/projects/tensorflow-install/tensorflow_logo.png"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/mahaveer0suthar.github.io/project/Tensorflow-Installation/" rel="permalink">Tensorflow Implementation Note: Installing Tensorflow and Keras on Windows
</a>
      
    </h2>

    
      <p class="page__date page__meta"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2017-05-09T00:00:00+05:30">May 09, 2017</time></p>
    
    
    <p class="archive__item-excerpt" itemprop="description">

Hello everyone, it’s been a long long while, hasn’t it? I was busy fulfilling my job and literally kept away from my blog. But hey, if this takes any longe...</p>
  </article>
</div>

          
        
          
            





<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "http://localhost:4000/mahaveer0suthar.github.io/images/projects/sequence-to-sequence/repeated_vector.png"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/mahaveer0suthar.github.io/project/Sequence-To-Sequence/" rel="permalink">Creating A Language Translation Model Using Sequence To Sequence Learning Approach
</a>
      
    </h2>

    
      <p class="page__date page__meta"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2016-12-20T00:00:00+05:30">December 20, 2016</time></p>
    
    
    <p class="archive__item-excerpt" itemprop="description">

Hello guys. It’s been quite a long while since my last blog post. It may sound like an excuse, but I’ve been struggling with finding a new place to move in...</p>
  </article>
</div>

          
        
          
            





<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "http://localhost:4000/mahaveer0suthar.github.io/images/projects/creating-text-generator-using-recurrent-neural-network/LSTM.png"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/mahaveer0suthar.github.io/project/Creating-Text-Generator-Using-Recurrent-Neural-Network/" rel="permalink">Creating A Text Generator Using Recurrent Neural Network
</a>
      
    </h2>

    
      <p class="page__date page__meta"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2016-11-14T00:00:00+05:30">November 14, 2016</time></p>
    
    
    <p class="archive__item-excerpt" itemprop="description">

Hello guys, it’s been another while since my last post, and I hope you’re all doing well with your own projects. I’ve been kept busy with my own stuff, too...</p>
  </article>
</div>

          
        
      </div>
    </div>
  
</div>


    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- New Ads -->
    <ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3852793730107162"
     data-ad-slot="4068904466"
     data-ad-format="auto"></ins>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
    
    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->

        

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
    
    
      <li><a href="http://github.com/mahaveer0suthar"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="http://localhost:4000/mahaveer0suthar.github.io/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2020 Mahaveer Suthar. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>
      </footer>
    </div>

    <script src="http://localhost:4000/mahaveer0suthar.github.io/assets/js/main.min.js"></script>




  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-84343367-1', 'auto');
  ga('send', 'pageview');
</script>






  
  <script type="text/javascript">
  	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  	var disqus_shortname = 'mahaveer0suthar';

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function() {
  		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  	})();

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function () {
  		var s = document.createElement('script'); s.async = true;
  		s.type = 'text/javascript';
  		s.src = '//' + disqus_shortname + '.disqus.com/count.js';
  		(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  	}());
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>






  </body>
</html>
